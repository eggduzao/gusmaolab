# This file lives at: GusmaoLab/.github/workflows/deploy.yaml

name: Deploy Pelican site to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout source with submodules
        uses: actions/checkout@v3
        with:
          submodules: recursive
          fetch-depth: 0

      - name: ğŸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"

      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pelican markdown typogrify

      - name: ğŸ” Debug list content images
        run: |
          echo "=== content tree (images) ==="
          ls -la content || true
          ls -la content/images || true
          find content/images -maxdepth 3 -type f || true

      - name: ğŸ› ï¸ Build the site
        run: |
          pelican content -s pelicanconf.py -o output --delete-output-directory

      - name: ğŸ” Debug list output images
        run: |
          echo "=== output tree (images) ==="
          ls -la output || true
          ls -la output/images || true
          find output/images -maxdepth 4 -type f || true

      - name: ğŸš€ Deploy to GitHub Pages (external repo)
        uses: peaceiris/actions-gh-pages@v3
        with:
          personal_token: ${{ secrets.PAGES_DEPLOY_TOKEN }}
          external_repository: eggduzao/eggduzao.github.io
          publish_branch: main
          publish_dir: ./output
          user_name: "eggduzao"
          user_email: "eggduzao@gmail.com"
