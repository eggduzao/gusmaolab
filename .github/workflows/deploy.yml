name: Deploy Pelican site to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout source with submodules
        uses: actions/checkout@v3
        with:
          submodules: recursive
          fetch-depth: 0

      - name: 🐍 Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: 📦 Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pelican markdown typogrify

      - name: 🛠️ Build the site
        run: |
          pelican content -s pelicanconf.py -o output --delete-output-directory

      - name: 🚀 Deploy to GitHub Pages (external repo)
        uses: peaceiris/actions-gh-pages@v3
        with:
          personal_token: ${{ secrets.PAGES_DEPLOY_TOKEN }}
          external_repository: eggduzao/eggduzao.github.io
          publish_branch: main
          publish_dir: ./output
          user_name: "eggduzao"
          user_email: "eggduzao@gmail.com"